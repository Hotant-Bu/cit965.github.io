---
sidebar_label: 02.cache
sidebar_position: 20
title: 02.cache
---

### store Interface

```go
// Store is a generic object storage and processing interface.  A
// Store holds a map from string keys to accumulators, and has
// operations to add, update, and delete a given object to/from the
// accumulator currently associated with a given key.  A Store also
// knows how to extract the key from a given object, so many operations
// are given only the object.
//
// In the simplest Store implementations each accumulator is simply
// the last given object, or empty after Delete, and thus the Store's
// behavior is simple storage.
//
// Reflector knows how to watch a server and update a Store.  This
// package provides a variety of implementations of Store.
type Store interface {

	// Add adds the given object to the accumulator associated with the given object's key
	Add(obj interface{}) error

	// Update updates the given object in the accumulator associated with the given object's key
	Update(obj interface{}) error

	// Delete deletes the given object from the accumulator associated with the given object's key
	Delete(obj interface{}) error

	// List returns a list of all the currently non-empty accumulators
	List() []interface{}

	// ListKeys returns a list of all the keys currently associated with non-empty accumulators
	ListKeys() []string

	// Get returns the accumulator associated with the given object's key
	Get(obj interface{}) (item interface{}, exists bool, err error)

	// GetByKey returns the accumulator associated with the given key
	GetByKey(key string) (item interface{}, exists bool, err error)

	// Replace will delete the contents of the store, using instead the
	// given list. Store takes ownership of the list, you should not reference
	// it after calling this function.
	Replace([]interface{}, string) error

	// Resync is meaningless in the terms appearing here but has
	// meaning in some implementations that have non-trivial
	// additional behavior (e.g., DeltaFIFO).
	Resync() error
}
```


### Indexer Interface

```go
// Indexer extends Store with multiple indices and restricts each
// accumulator to simply hold the current object (and be empty after
// Delete).
//
// There are three kinds of strings here:
// 1. a storage key, as defined in the Store interface,
// 2. a name of an index, and
// 3. an "indexed value", which is produced by an IndexFunc and
//    can be a field value or any other string computed from the object.
type Indexer interface {
	Store
	// Index returns the stored objects whose set of indexed values
	// intersects the set of indexed values of the given object, for
	// the named index
	Index(indexName string, obj interface{}) ([]interface{}, error)
	// IndexKeys returns the storage keys of the stored objects whose
	// set of indexed values for the named index includes the given
	// indexed value
	IndexKeys(indexName, indexedValue string) ([]string, error)
	// ListIndexFuncValues returns all the indexed values of the given index
	ListIndexFuncValues(indexName string) []string
	// ByIndex returns the stored objects whose set of indexed values
	// for the named index includes the given indexed value
	ByIndex(indexName, indexedValue string) ([]interface{}, error)
	// GetIndexer return the indexers
	GetIndexers() Indexers

	// AddIndexers adds more indexers to this store.  If you call this after you already have data
	// in the store, the results are undefined.
	AddIndexers(newIndexers Indexers) error
}
```

Indexer 接口包含以下方法：

- Index(indexName string, obj interface{}) ([]interface{}, error)：返回给定对象的索引值集与存储对象的索引值集相交的存储对象，针对指定的索引名称。
- IndexKeys(indexName, indexedValue string) ([]string, error)：返回存储对象的存储键，这些对象的指定索引名称的索引值集包含给定的索引值。
- ListIndexFuncValues(indexName string) []string：返回给定索引的所有索引值。
- ByIndex(indexName, indexedValue string) ([]interface{}, error)：返回指定索引名称的索引值集包含给定索引值的存储对象。
- GetIndexers() Indexers：返回索引器。
- AddIndexers(newIndexers Indexers) error：向该存储中添加更多索引器。如果在已经有数据的存储中调用此方法，结果是未定义的。
- IndexFunc 类型定义了一个函数，该函数接受一个对象并返回由该对象计算出的一组索引值。这类函数用于根据需要对对象进行多个不同类型的索引。

```go

// Index maps the indexed value to a set of keys in the store that match on that value
type Index map[string]sets.String

// Indexers maps a name to a IndexFunc
type Indexers map[string]IndexFunc

// Indices maps a name to an Index
type Indices map[string]Index

```
作为初学者，我们主要是要理解这三个结构，可以进行代码调试

### cache

```txt
KeyFunc 是一个函数类型，它从给定对象中提取键。MetaNamespaceKeyFunc 是一个默认的 KeyFunc，可以从实现 meta.Interface 的 API 对象中提取键。键的格式为 <namespace>/<name>（如果有 namespace 的话）。

cache 结构体实现了 Store 和 Indexer 接口。它使用 ThreadSafeStore 作为缓存存储，确保线程安全。keyFunc 用于从对象中生成键。

NewStore 和 NewIndexer 分别返回实现了 Store 和 Indexer 接口的 cache 实例。这些实例可以用于存储、更新、删除、查询对象，并根据索引器进行索引操作。
```
