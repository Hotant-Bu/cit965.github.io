---
sidebar_label: 29.gostyle
sidebar_position: 11
title: 29.gostyle
---

### PR #321
> Use ID instead of Id (go style) everywhere 【代码中都用 ID 哦！】

### PR #319
> Initial add of an environment variable for the kubernetes master.

从环境变量中获取 apiserver的地址，没有的话，默认是 localhost:8080

![](https://raw.githubusercontent.com/mouuii/picture/master/%E6%88%AA%E5%B1%8F2023-05-12%20%E4%B8%8B%E5%8D%884.34.30.png)

### PR #277
> Add sync behavior to the pod registry.  Expand tests.

- podStatus 定义枚举
- 更新 pod 时候，添加同步等待逻辑

```go

type PodStatus string

const (
	PodRunning PodStatus = "Running"
	PodPending PodStatus = "Pending"
	PodStopped PodStatus = "Stopped"
)


func (storage *PodRegistryStorage) Update(obj interface{}) (<-chan interface{}, error) {
	pod := obj.(api.Pod)
	if len(pod.ID) == 0 {
		return nil, fmt.Errorf("id is unspecified: %#v", pod)
	}

	return apiserver.MakeAsync(func() (interface{}, error) {
		err := storage.registry.UpdatePod(pod)
		if err != nil {
			return nil, err
		}
		return storage.waitForPodRunning(pod)
	}), nil
}

func (storage *PodRegistryStorage) waitForPodRunning(pod api.Pod) (interface{}, error) {
	for {
		podObj, err := storage.Get(pod.ID)

		if err != nil || podObj == nil {
			return nil, err
		}
		podPtr, ok := podObj.(*api.Pod)
		if !ok {
			// This should really never happen.
			return nil, fmt.Errorf("Error %#v is not an api.Pod!", podObj)
		}
		switch podPtr.CurrentState.Status {
		case api.PodRunning, api.PodStopped:
			return pod, nil
		default:
			time.Sleep(storage.podPollPeriod)
		}
	}
	return pod, nil
}

```