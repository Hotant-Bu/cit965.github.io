---
sidebar_label: 32.podip
sidebar_position: 11
title: 32.podip
---

### PR #483
> Add a caching minion registry. [增加了缓存，不用每次调用 cloudprovider]

### PR #486
> Make RESTful operations return 404 Not Found when the target resource does not exist. [如果资源没找到，返回404]

![](https://raw.githubusercontent.com/mouuii/picture/master/%E6%88%AA%E5%B1%8F2023-05-16%20%E4%B8%8B%E5%8D%885.22.53.png)

### PR #452
> Initial framework for external volumes [抽象 volume 接口]

```go
// All volume types are expected to implement this interface
type Interface interface {
	// Prepares and mounts/unpacks the volume to a directory path.
	// This procedure must be idempotent.
	SetUp()
	// Returns the directory path the volume is mounted to.
	GetPath() string
	// Unmounts the volume and removes traces of the SetUp procedure.
	// This procedure must be idempotent.
	TearDown()
}

```

### PR #522 525
> Added HasAll utility method for string set.
```go
// HasAll returns true iff all items are contained in the set.
func (s StringSet) HasAll(items ...string) bool {
	for _, item := range items {
		if !s.Has(item) {
			return false
		}
	}
	return true
}

// IsSuperset returns true iff s1 is a superset of s2.
func (s1 StringSet) IsSuperset(s2 StringSet) bool {
	for item, _ := range s2 {
		if !s1.Has(item) {
			return false
		}
	}
	return true
}

```


### PR #524
> Make the service reconciller use the API, not a PodRegistry

重大突破，组件开始从apiserver 获取数据，而不是直接从etcd

![](https://raw.githubusercontent.com/mouuii/picture/master/%E6%88%AA%E5%B1%8F2023-05-16%20%E4%B8%8B%E5%8D%886.07.06.png)

![](https://raw.githubusercontent.com/mouuii/picture/master/%E6%88%AA%E5%B1%8F2023-05-16%20%E4%B8%8B%E5%8D%886.07.06.png)


### PR #493 #505
> Implemented via HTTP and websocket
> Add client watch capability


##### 493 实现了 websocket 和 chunked

```go

// ResourceWatcher should be implemented by all RESTStorage objects that
// want to offer the ability to watch for changes through the watch api.
type ResourceWatcher interface {
	WatchAll() (watch.Interface, error)
	WatchSingle(id string) (watch.Interface, error)
}
```

##### 505 实现了 watch 客户端

```go
// StreamWatcher turns any stream for which you can write a Decoder interface
// into a watch.Interface.
type StreamWatcher struct {
	source Decoder
	result chan Event
	sync.Mutex
	stopped bool
}

// NewStreamWatcher creates a StreamWatcher from the given decoder.
func NewStreamWatcher(d Decoder) *StreamWatcher {
	sw := &StreamWatcher{
		source: d,
		// It's easy for a consumer to add buffering via an extra
		// goroutine/channel, but impossible for them to remove it,
		// so nonbuffered is better.
		result: make(chan Event),
	}
	go sw.receive()
	return sw
}
```